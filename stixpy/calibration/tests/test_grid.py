import numpy as np
import pytest

import astropy.units as u

from stixpy.calibration.grid import get_grid_internal_shadowing


# Output values taken from IDL routine
@pytest.mark.parametrize(
    "input,out", [([0, 0] * u.arcsec,
                   [0.35590845, 0.22986810, 0.26036045, 0.25687781, 0.27025357, 0.23020910,
                    0.37963411, 0.24838811, 0.0000000, 0.0000000, 0.20558731, 0.22899848,
                    0.083853617, 0.26332209, 0.23131208, 0.26135680, 0.28662792, 0.17217430,
                    0.20970213, 0.26654890, 0.24699830, 0.25651491, 0.26775527, 0.23084085,
                    0.27006894, 0.24883848, 0.22034471, 0.25803387, 0.36454561, 0.24306358,
                    0.25005639, 0.26104531]),
                  ([-1625.0, -700.0] * u.arcsec,
                   [0.32721832, 0.21009506, 0.25727683, 0.25127667, 0.26643950, 0.21521379,
                    0.32667473, 0.23975982, 0.0000000, 0.0000000, 0.20558731, 0.22899848,
                    0.083853617, 0.25780892, 0.22469133, 0.25833082, 0.28662792, 0.17217430,
                    0.20970213, 0.26297450, 0.24525881, 0.25606486, 0.24206956, 0.22962472,
                    0.24107693, 0.24160822, 0.21244708, 0.24805430, 0.34061235, 0.23811999,
                    0.23491424, 0.25856388])])
def test_grid_transmission(input, out):
    grid_transmission = get_grid_internal_shadowing(input)
    assert np.allclose(grid_transmission, np.array(out))
